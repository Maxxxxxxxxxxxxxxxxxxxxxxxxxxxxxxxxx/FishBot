# # import telebot
# # from telebot import types
# # import json
# # import os
# # from secrets import secrets
# # from logic_json import *
# #
# # token = secrets.get('BOT_API_TOKEN')
# # bot = telebot.TeleBot(token)
# #
# #
# # # –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ –∏ —Ñ–∞–π–ª—É
# # JSON_FOLDER = 'json'  # –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏
# # SAVE_FILE_RODS = os.path.join(JSON_FOLDER, 'selected_rods.json')  # –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
# #
# #
# #
# # # –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞
# # if os.path.exists(SAVE_FILE_RODS):
# #     with open(SAVE_FILE_RODS, 'r', encoding='utf-8') as f:
# #         selected_rods = json.load(f)
# # else:
# #     selected_rods = {}
# #
# # def load_rods_select():
# #     if os.path.exists(SAVE_FILE_RODS):
# #         with open(SAVE_FILE_RODS, 'r', encoding='utf-8') as file:
# #             return json.load(file)
# #     return {}
# # # –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Ñ–∞–π–ª
# # def save_state_rods(selected_rods):
# #     with open(SAVE_FILE_RODS, 'w', encoding='utf-8') as f:
# #         json.dump(selected_rods, f, ensure_ascii=False, indent=4)
# #
# #
# #
# # # –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å —É—á–µ—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
# # def create_markup_rods(user_selected_rods):
# #     markup = types.InlineKeyboardMarkup(row_width=1)
# #     buttons = [
# #         types.InlineKeyboardButton(f"{'‚úÖ ' if 'rod1' in user_selected_rods else '100$ '}Plastic rod üé£", callback_data="rod1"),
# #         types.InlineKeyboardButton(f"{'‚úÖ ' if 'rod2' in user_selected_rods else '500$ '}Improved rod üé£", callback_data="rod2"),
# #         types.InlineKeyboardButton(f"{'‚úÖ ' if 'rod3' in user_selected_rods else '8000$ '}Steel rod üé£", callback_data="rod3"),
# #         types.InlineKeyboardButton(f"{'‚úÖ ' if 'rod4' in user_selected_rods else '50000$ '}Fiberglass rod üé£", callback_data="rod4"),
# #         types.InlineKeyboardButton(f"{'‚úÖ ' if 'rod5' in user_selected_rods else '100000$ '}Heavy rod üé£", callback_data="rod5"),
# #         types.InlineKeyboardButton(f"{'‚úÖ ' if 'rod6' in user_selected_rods else '250000$ '}Alloy rod üé£üî•", callback_data="rod6"),
# #         types.InlineKeyboardButton(f"{'‚úÖ ' if 'rod7' in user_selected_rods else '1000000$ '}Lava rod üé£üî•", callback_data="rod7"),
# #         types.InlineKeyboardButton(f"{'‚úÖ ' if 'rod8' in user_selected_rods else '10000000$ '}Magma rod üé£üî•", callback_data="rod8"),
# #         types.InlineKeyboardButton("back", callback_data='button_shop')
# #     ]
# #     markup.add(*buttons)
# #     return markup
# #
# # # –§—É–Ω–∫—Ü–∏—è test_f, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
# # # @bot.callback_query_handler(func=lambda call: call.data in ["rod1", 'rod2', 'rod3'])
# # @bot.callback_query_handler(func=lambda call: True)
# # def rods_func(chat_id):
# #     user_id = str(chat_id)  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–æ–∫—É, —Ç–∞–∫ –∫–∞–∫ JSON –∫–ª—é—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞–º–∏
# #
# #     # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# #     user_selected_buttons = selected_rods.get(user_id, [])
# #
# #
# #     # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —Ç—Ä–µ–º—è –∫–Ω–æ–ø–∫–∞–º–∏
# #     markup = create_markup_rods(user_selected_buttons)
# #
# #     # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
# #     bot.send_message(chat_id, "Choose fishing rod:", reply_markup=markup)
# #
# # # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
# # @bot.callback_query_handler(func=lambda call: call.data in ["rod1", 'rod2', 'rod3',"rod4", 'rod5', 'rod6',"rod7", 'rod8'])
# # def callback_query_rods(call):
# #     user_id = str(call.from_user.id)  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–æ–∫—É, —Ç–∞–∫ –∫–∞–∫ JSON –∫–ª—é—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞–º–∏
# #     button_id = call.data
# #     user_money = load_money_data()
# #
# #
# #     if user_id not in selected_rods:
# #         selected_rods[user_id] = "Empty"
# #
# #     if button_id in selected_rods[user_id]:
# #         # –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞, —É–±–∏—Ä–∞–µ–º –µ—ë –∏–∑ —Å–ø–∏—Å–∫–∞
# #         selected_rods[user_id] = "Empty"
# #     else:
# #         # –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –º–µ–Ω—å—à–µ –¥–≤—É—Ö –∫–Ω–æ–ø–æ–∫, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é
# #
# #         match button_id:
# #             case "rod1":
# #                 if user_money[user_id] >= 100:
# #                     user_money[user_id] -= 100
# #                     selected_rods[user_id]=(button_id)
# #                 else:
# #                     bot.answer_callback_query(call.id, text="You don't have enough money(", show_alert=False)
# #                     return
# #             case "rod2":
# #                 if user_money[user_id] >= 500:
# #                     user_money[user_id] -= 500
# #                     selected_rods[user_id]=(button_id)
# #                 else:
# #                     bot.answer_callback_query(call.id, text="You don't have enough money(", show_alert=False)
# #                     return
# #             case "rod3":
# #                 if user_money[user_id] >= 8000:
# #                     user_money[user_id] -= 8000
# #                     selected_rods[user_id]=(button_id)
# #                 else:
# #                     bot.answer_callback_query(call.id, text="You don't have enough money(", show_alert=False)
# #                     return
# #             case "rod4":
# #                 if user_money[user_id] >= 50000:
# #                     user_money[user_id] -= 50000
# #                     selected_rods[user_id]=(button_id)
# #                 else:
# #                     bot.answer_callback_query(call.id, text="You don't have enough money(", show_alert=False)
# #                     return
# #             case "rod5":
# #                 if user_money[user_id] >= 100000:
# #                     user_money[user_id] -= 100000
# #                     selected_rods[user_id]=(button_id)
# #                 else:
# #                     bot.answer_callback_query(call.id, text="You don't have enough money(", show_alert=False)
# #                     return
# #             case "rod6":
# #                 if user_money[user_id] >= 250000:
# #                     user_money[user_id] -= 250000
# #                     selected_rods[user_id]=(button_id)
# #                 else:
# #                     bot.answer_callback_query(call.id, text="You don't have enough money(", show_alert=False)
# #                     return
# #             case "rod7":
# #                 if user_money[user_id] >= 1000000:
# #                     user_money[user_id] -= 1000000
# #                     selected_rods[user_id]=(button_id)
# #                 else:
# #                     bot.answer_callback_query(call.id, text="You don't have enough money(", show_alert=False)
# #                     return
# #             case "rod8":
# #                 if user_money[user_id] >= 10000000:
# #                     user_money[user_id] -= 1000000
# #                     selected_rods[user_id]=(button_id)
# #                 else:
# #                     bot.answer_callback_query(call.id, text="You don't have enough money(", show_alert=False)
# #                     return
# #
# #
# #
# #
# #
# #     # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
# #     save_state_rods(selected_rods)
# #     save_money_data(user_money)
# #     # –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
# #     updated_markup_rods = create_markup_rods(selected_rods.get(user_id, []))
# #     bot.edit_message_reply_markup(
# #         chat_id=call.message.chat.id,
# #         message_id=call.message.message_id,
# #         reply_markup=updated_markup_rods
# #     )
# # def get_rods_number(rods_type):
# #     if rods_type in ["Empty",[]]:
# #         return 1
# #     return int(rods_type[-1])
# # ------------------------------------------------------------------------------------------------------------------------------
#
# import telebot
# from telebot import types
# import json
# import os
# from secrets import secrets
# from logic_json import *
#
# token = secrets.get('BOT_API_TOKEN')
# bot = telebot.TeleBot(token)
#
# # –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ –∏ —Ñ–∞–π–ª—É
# JSON_FOLDER = 'json'
# SAVE_FILE_RODS = os.path.join(JSON_FOLDER, 'selected_rods.json')
#
# # –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞
# if os.path.exists(SAVE_FILE_RODS):
#     with open(SAVE_FILE_RODS, 'r', encoding='utf-8') as f:
#         selected_rods = json.load(f)
# else:
#     selected_rods = {}
#
#
# def load_rods_select():
#     if os.path.exists(SAVE_FILE_RODS):
#         with open(SAVE_FILE_RODS, 'r', encoding='utf-8') as file:
#             return json.load(file)
#     return {}
#
#
# def save_state_rods(selected_rods):
#     with open(SAVE_FILE_RODS, 'w', encoding='utf-8') as f:
#         json.dump(selected_rods, f, ensure_ascii=False, indent=4)
#
#
# def create_markup_rods(user_selected_rod):
#     markup = types.InlineKeyboardMarkup(row_width=1)
#     buttons = [
#         types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod1' else '100$ '}Plastic rod üé£",
#                                    callback_data="rod1"),
#         types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod2' else '500$ '}Improved rod üé£",
#                                    callback_data="rod2"),
#         types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod3' else '8000$ '}Steel rod üé£",
#                                    callback_data="rod3"),
#         types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod4' else '50000$ '}Fiberglass rod üé£",
#                                    callback_data="rod4"),
#         types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod5' else '100000$ '}Heavy rod üé£",
#                                    callback_data="rod5"),
#         types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod6' else '250000$ '}Alloy rod üé£üî•",
#                                    callback_data="rod6"),
#         types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod7' else '1000000$ '}Lava rod üé£üî•",
#                                    callback_data="rod7"),
#         types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod8' else '10000000$ '}Magma rod üé£üî•",
#                                    callback_data="rod8"),
#         types.InlineKeyboardButton("back", callback_data='button_shop')
#     ]
#     markup.add(*buttons)
#     return markup
#
#
# def rods_func(chat_id, message_id=None):
#     user_id = str(chat_id)
#     selected_rods = load_rods_select()
#
#     if user_id not in selected_rods:
#         selected_rods[user_id] = "Empty"
#         save_state_rods(selected_rods)
#
#     current_rod = selected_rods.get(user_id, "Empty")
#     markup = create_markup_rods(current_rod)
#
#     if message_id:  # –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω message_id, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
#         try:
#             bot.edit_message_text(
#                 chat_id=chat_id,
#                 message_id=message_id,
#                 text="Choose fishing rod:",
#                 reply_markup=markup
#             )
#         except Exception as e:
#             print(f"Error editing message: {e}")
#             bot.send_message(chat_id, "Choose fishing rod:", reply_markup=markup)
#     else:  # –ï—Å–ª–∏ message_id –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
#         bot.send_message(chat_id, "Choose fishing rod:", reply_markup=markup)
#
#
# def callback_query_rods(call):
#     user_id = str(call.from_user.id)
#     button_id = call.data
#     user_money = load_money_data()
#     selected_rods = load_rods_select()
#
#     if user_id not in selected_rods:
#         selected_rods[user_id] = "Empty"
#
#     price_map = {
#         "rod1": 100,
#         "rod2": 500,
#         "rod3": 8000,
#         "rod4": 50000,
#         "rod5": 100000,
#         "rod6": 250000,
#         "rod7": 1000000,
#         "rod8": 10000000
#     }
#
#     if button_id == selected_rods.get(user_id, "Empty"):
#         # –ï—Å–ª–∏ —É–¥–æ—á–∫–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞, —Å–Ω–∏–º–∞–µ–º –≤—ã–±–æ—Ä
#         selected_rods[user_id] = "Empty"
#     else:
#         # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ö–≤–∞—Ç–∞–µ—Ç –ª–∏ –¥–µ–Ω–µ–≥
#         price = price_map.get(button_id, 0)
#         if user_money.get(user_id, 0) >= price:
#             user_money[user_id] -= price
#             selected_rods[user_id] = button_id
#             save_money_data(user_money)
#         else:
#             bot.answer_callback_query(call.id, text="You don't have enough money(", show_alert=False)
#             return
#
#     save_state_rods(selected_rods)
#
#     updated_markup = create_markup_rods(selected_rods.get(user_id, "Empty"))
#
#     try:
#         bot.edit_message_reply_markup(
#             chat_id=call.message.chat.id,
#             message_id=call.message.message_id,
#             reply_markup=updated_markup
#         )
#     except Exception as e:
#         print(f"Error updating markup: {e}")
#
#     bot.answer_callback_query(call.id)
#
#
# def get_rods_number(rods_type):
#     if not rods_type or rods_type == "Empty":
#         return 1
#     return int(rods_type[-1]) if rods_type[-1].isdigit() else 1


import telebot
from telebot import types
import json
import os
from secrets import secrets
from logic_json import *

token = secrets.get('BOT_API_TOKEN')
bot = telebot.TeleBot(token)

JSON_FOLDER = 'json'
SAVE_FILE_RODS = os.path.join(JSON_FOLDER, 'selected_rods.json')

if os.path.exists(SAVE_FILE_RODS):
    with open(SAVE_FILE_RODS, 'r', encoding='utf-8') as f:
        selected_rods = json.load(f)
else:
    selected_rods = {}

def load_rods_select():
    if os.path.exists(SAVE_FILE_RODS):
        with open(SAVE_FILE_RODS, 'r', encoding='utf-8') as file:
            return json.load(file)
    return {}

def save_state_rods(selected_rods):
    with open(SAVE_FILE_RODS, 'w', encoding='utf-8') as f:
        json.dump(selected_rods, f, ensure_ascii=False, indent=4)

def create_markup_rods(user_selected_rod):
    markup = types.InlineKeyboardMarkup(row_width=1)
    buttons = [
        types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod1' else '100$ '}Plastic rod üé£", callback_data="rod1"),
        types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod2' else '500$ '}Improved rod üé£", callback_data="rod2"),
        types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod3' else '8000$ '}Steel rod üé£", callback_data="rod3"),
        types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod4' else '50000$ '}Fiberglass rod üé£", callback_data="rod4"),
        types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod5' else '100000$ '}Heavy rod üé£", callback_data="rod5"),
        types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod6' else '250000$ '}Alloy rod üé£üî•", callback_data="rod6"),
        types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod7' else '1000000$ '}Lava rod üé£üî•", callback_data="rod7"),
        types.InlineKeyboardButton(f"{'‚úÖ ' if user_selected_rod == 'rod8' else '10000000$ '}Magma rod üé£üî•", callback_data="rod8"),
        types.InlineKeyboardButton("back", callback_data='button_shop')
    ]
    markup.add(*buttons)
    return markup

def rods_func(chat_id, inline_message_id=None, message_id=None):
    user_id = str(chat_id)
    selected_rods = load_rods_select()

    if user_id not in selected_rods:
        selected_rods[user_id] = "Empty"
        save_state_rods(selected_rods)

    current_rod = selected_rods.get(user_id, "Empty")
    markup = create_markup_rods(current_rod)

    if inline_message_id:
        try:
            bot.edit_message_text(
                inline_message_id=inline_message_id,
                text="Choose fishing rod:",
                reply_markup=markup
            )
        except Exception as e:
            print(f"Error editing inline message: {e}")
    elif message_id:
        try:
            bot.edit_message_text(
                chat_id=chat_id,
                message_id=message_id,
                text="Choose fishing rod:",
                reply_markup=markup
            )
        except Exception as e:
            print(f"Error editing message: {e}")
            bot.send_message(chat_id, "Choose fishing rod:", reply_markup=markup)
    else:
        bot.send_message(chat_id, "Choose fishing rod:", reply_markup=markup)

def callback_query_rods(call):
    user_id = str(call.from_user.id)
    button_id = call.data
    user_money = load_money_data()
    selected_rods = load_rods_select()

    if user_id not in selected_rods:
        selected_rods[user_id] = "Empty"

    price_map = {
        "rod1": 100, "rod2": 500, "rod3": 8000, "rod4": 50000,
        "rod5": 100000, "rod6": 250000, "rod7": 1000000, "rod8": 10000000
    }

    if button_id == selected_rods.get(user_id, "Empty"):
        selected_rods[user_id] = "Empty"
    else:
        price = price_map.get(button_id, 0)
        if user_money.get(user_id, 0) >= price:
            user_money[user_id] -= price
            selected_rods[user_id] = button_id
            save_money_data(user_money)
        else:
            bot.answer_callback_query(call.id, text="You don't have enough money(", show_alert=False)
            return

    save_state_rods(selected_rods)
    updated_markup = create_markup_rods(selected_rods.get(user_id, "Empty"))

    try:
        if hasattr(call, 'inline_message_id'):
            bot.edit_message_text(
                inline_message_id=call.inline_message_id,
                text="Choose fishing rod:",
                reply_markup=updated_markup
            )
        else:
            bot.edit_message_reply_markup(
                chat_id=call.message.chat.id,
                message_id=call.message.message_id,
                reply_markup=updated_markup
            )
    except Exception as e:
        print(f"Error updating markup: {e}")

    bot.answer_callback_query(call.id)

def get_rods_number(rods_type):
    if not rods_type or rods_type == "Empty":
        return 1
    return int(rods_type[-1]) if rods_type[-1].isdigit() else 1